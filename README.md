# Staking Contract Function Test (Go + BSC Testnet)

This project demonstrates how to interact with a Solidity staking contract on **BSC Testnet** using **Go** and `go-ethereum` (`abigen`) bindings.

---

## **Folder Structure**

```
staking-contract-function-test/
├── contract.abi           # ABI of your staking contract
├── go.mod                 # Go module file
├── go.sum                 # Go dependencies lock file
├── main.go                # Main Go program to read/write contract
└── mycontract/            # Folder for Go bindings generated by abigen
    └── contract.go        # Go bindings of the contract
```

---

## **Prerequisites**

1. **Go 1.24+** installed.
2. **Geth** installed (for `abigen`).
3. Your staking contract **ABI** (`contract.abi`) and **contract address**.
4. Private key for sending transactions (state-changing functions).

---

## **Setup Steps**

### 1. Initialize the Go module

```bash
cd staking-contract-function-test
go mod init staking-contract-function-test
```

### 2. Install dependencies

```bash
go get github.com/ethereum/go-ethereum@v1.16.7
```

### 2b. Install `abigen` (Go Ethereum ABI generator)

`abigen` comes with the `go-ethereum` repo. To install it:

```bash
go install github.com/ethereum/go-ethereum/cmd/abigen@latest
```

Make sure `$GOPATH/bin` is in your `PATH` so you can call `abigen` globally:

```bash
export PATH=$PATH:$(go env GOPATH)/bin
```

Check installation:

```bash
abigen --version
```

### 3. Generate Go bindings from ABI

```bash
abigen --abi contract.abi --pkg mycontract --out mycontract/contract.go
```

> This will create `mycontract/contract.go` which contains all Go functions corresponding to your Solidity contract.

### 4. Write your `main.go`

Example: reading `stakeDuration()`:

```go
package main

import (
    "context"
    "fmt"
    "log"

    "github.com/ethereum/go-ethereum/accounts/abi/bind"
    "github.com/ethereum/go-ethereum/common"
    "github.com/ethereum/go-ethereum/ethclient"

    "staking-contract-function-test/mycontract"
)

func main() {
    client, err := ethclient.Dial("https://data-seed-prebsc-1-s1.binance.org:8545")
    if err != nil {
        log.Fatal(err)
    }

    contractAddress := common.HexToAddress("0x87a54a4cC6bfAc0D1Fd3286619508d1299753c7b")
    contract, err := mycontract.NewMycontract(contractAddress, client)
    if err != nil {
        log.Fatal(err)
    }

    duration, err := contract.StakeDuration(&bind.CallOpts{Context: context.Background()})
    if err != nil {
        log.Fatal(err)
    }

    fmt.Println("Stake Duration:", duration)
}
```

---

## **Running the Program**

```bash
go mod tidy      # Install missing dependencies
go run main.go   # Run the program
```

- For **read-only functions** (`view` functions), no private key is required.
- For **write functions** (`nonpayable`), create a `bind.TransactOpts` with your private key and chain ID (97 = BSC Testnet).

---

## **Adding Write Functions Example**

```go
privateKey, _ := crypto.HexToECDSA("YOUR_PRIVATE_KEY")
auth, _ := bind.NewKeyedTransactorWithChainID(privateKey, big.NewInt(97))

tx, err := contract.Stake(auth, big.NewInt(100))
fmt.Println("Transaction sent:", tx.Hash().Hex())
```

---

## **Notes**

- Make sure **package names match**: `main.go` uses `package main`; generated Go bindings use `package mycontract`.
- Function names are **case-sensitive** and match Solidity names.
- Use `Filter<EventName>` or `Watch<EventName>` to subscribe to events like `Staked` or `RewardClaimed`.